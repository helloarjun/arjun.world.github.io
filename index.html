<!DOCTYPE html>
<html>
<head>
  <title>arjun.world</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .error { color: red; background: #fff0f0; padding: 10px; border: 1px solid #ffd0d0; }
    .debug { background: #f0f0f0; padding: 10px; font-family: monospace; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>arjun.world</h1>
  <p>This contains miscellaneous screenshots, links, quotes, and videos. I suppose in some sense it functions as a public blog.</p>
  
  <button onclick="loadContent()">Reload Content</button>
  <div id="debug" class="debug"></div>
  <div id="content">Loading content...</div>
  
  <script>
    // Show debug info directly on page
    function debug(msg) {
      document.getElementById('debug').textContent += msg + "\n";
    }
    
    // Load content with explicit error handling
    function loadContent() {
      document.getElementById('debug').textContent = ""; // Clear debug area
      document.getElementById('content').innerHTML = "Loading content...";
      
      debug("Starting content load at " + new Date().toISOString());
      
      // Directly fetch the index.json with a cache-busting query
      fetch('index.json?nocache=' + Date.now())
        .then(response => {
          debug("Fetch response status: " + response.status);
          if (!response.ok) {
            throw new Error("HTTP error " + response.status);
          }
          return response.text();  // Get as text first to debug
        })
        .then(text => {
          debug("Received text (" + text.length + " bytes): " + text.substring(0, 100) + "...");
          try {
            return JSON.parse(text);  // Parse the JSON
          } catch (e) {
            debug("JSON PARSE ERROR: " + e.message);
            throw new Error("JSON parse error: " + e.message);
          }
        })
        .then(data => {
          debug("Parsed JSON: " + JSON.stringify(data).substring(0, 100) + "...");
          debug("Is array: " + Array.isArray(data));
          debug("Length: " + (Array.isArray(data) ? data.length : "N/A"));
          
          if (!Array.isArray(data) || data.length === 0) {
            document.getElementById('content').innerHTML = "No posts found. The index.json file doesn't contain a valid array of posts.";
            return;
          }
          
          // Build HTML for posts
          let html = "";
          data.forEach(post => {
            debug("Processing post: " + JSON.stringify(post).substring(0, 100));
            html += "<div style='margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px;'>";
            
            if (post.type === "image") {
              html += `<img src="${post.path}" style="max-width: 100%;" onerror="this.onerror=null; this.src=''; this.alt='Image failed to load';">`;
              if (post.text) {
                html += `<p>${post.text}</p>`;
              }
            } else if (post.type === "text" || post.type === "link") {
              html += `<p>${post.text || "No text available"}</p>`;
            } else {
              html += `<p>Unknown post type: ${post.type}</p>`;
            }
            
            html += "</div>";
          });
          
          document.getElementById('content').innerHTML = html;
        })
        .catch(error => {
          debug("ERROR: " + error.message);
          document.getElementById('content').innerHTML = `<div class="error">Error loading content: ${error.message}</div>`;
        });
    }
    
    // Load content when page loads
    window.onload = loadContent;
  </script>
</body>
</html>
